# M4.30 Memo

Date: 2026-02-06

## Goal
Write the required A.13 diagnostics event `phantom_asset_detected` when a phantom asset is detected.

## What Shipped
- Phantom detection now emits A.13 JSONL event:
  - `justphoto_opencode/Infrastructure/Capture/PhantomAssetHealer.swift`
  - On phantom detection, calls `DiagnosticsLogger.logPhantomAssetDetected(...)` with:
    - `asset_id_hash`
    - `auth_snapshot`
    - `heal_action`

- Isolation fix for Swift 6 compatibility:
  - `justphoto_opencode/Infrastructure/Diagnostics/DiagnosticsLogger.swift`
  - Marked `logPhantomAssetDetected(...)` as `nonisolated` so it can be called off-main safely.

## Verification
- Manual: trigger phantom via DebugTools “M4.29 Inject + Heal Phantom Asset”, then export diagnostics logs.
- Expect one JSONL line with:
  - `event`: `phantom_asset_detected`
  - `payload.asset_id_hash` / `payload.auth_snapshot` / `payload.heal_action`

## Notes
- If current session cannot be loaded at detection time, emission is skipped and console prints:
  - `PhantomAssetDetectedLogSkipped: missing_session`

# M6.17 Thumbnail From Pending 归档

**任务**
- 从 pending 文件生成真实缩略图，修复白图与 CRC error。
- 保留 optimistic thumb，真实缩略图生成后原地替换并标记 ready。

**实现摘要**
- `ThumbnailPipeline` 使用 `CGImageSource` 解码 pending 文件并生成 256x256 JPEG（质量 0.85）。
- 增加 pending 文件存在与大小门槛，并使用 300ms/1s 延迟重试。
- 真实缩略图只在解码成功后写入并更新 `thumb_cache_rel_path` 与 `thumbnail_state`。
- optimistic thumb 仍即时写入（不标记 ready），避免 UI 等待 IO。

**验证**
- 真机：拍照后 Filmstrip 显示真实缩略图，不再出现白图。
- 控制台不再出现 `IDAT CRC error` / `Bad image source`。
- DebugTools → `PrintLatestSessionItem` 可见 pending 与 thumb 文件均存在，thumb 为 `.jpg`。
 - 验证结果：已通过（2026-02-24）。

**涉及文件**
- /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode/Infrastructure/Capture/ThumbnailPipeline.swift

**Assumptions**
- pending 文件由上游已写入真实相机数据并具备正确扩展名。

# M6.17 RefTarget Store + Real Capture Data 归档

**任务**
- M6.17：将 RefTarget 写入 session 级存储，避免低质量帧覆盖已存快照。
- 用真实 `AVCapturePhotoOutput` 数据替换 pending 占位图，确保落盘格式与扩展名一致。
- DebugTools 调用实时帧运行 RefTargetExtractor，避免误用静态 64x64 资源。

**实现摘要**
- `CameraFrameSource` 接入 `AVCapturePhotoOutput` 并提供 `capturePhotoDataFromActive()`，返回 HEIC/JPEG 数据与扩展名。
- `CaptureCoordinator` 使用真实拍照数据写入 pending 文件，增加最小字节数防护，并记录正确的扩展名。
- `RefTargetSessionStore` 增加覆盖防呆：新指标太少或不优于旧指标时拒绝覆盖。
- `DebugToolsScreen` 统一使用 `TierScheduler.debugLatestFrame()`，并在后台 `Task.detached` 执行提取。

**验证**
- `xcodebuild -project /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode.xcodeproj -scheme justphoto_opencode -destination 'platform=iOS Simulator,name=iPhone 17' build`
- 真机：拍照落盘不再出现 68 bytes 白图；DebugTools 执行 RefTargetExtractor 输出稳定。

**涉及文件**
- /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode/Infrastructure/Camera/CameraFrameSource.swift
- /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode/Infrastructure/Capture/CaptureCoordinator.swift
- /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode/Infrastructure/Session/RefTargetSessionStore.swift
- /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode/Features/Settings/DebugToolsScreen.swift
- /Users/fanqie/Projects/opencode_just_photo/justphoto_opencode/Infrastructure/Session/SessionRepository.swift

**Assumptions**
- 未运行自动化测试，仅完成代码级构建与真机验证建议。
